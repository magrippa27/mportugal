---
import { getCollection } from 'astro:content';
import MainLayout from '../../../../layouts/MainLayout.astro';
import PostCard from '../../../../components/PostCard.astro';
import { type Language, useTranslations, languages } from '../../../../i18n/utils';

export async function getStaticPaths() {
  const allPosts = await getCollection('blog');
  const categories = [...new Set(allPosts.flatMap(post => post.data.categories || []))];
  
  const paths = [];
  for (const lang of Object.keys(languages)) {
    for (const category of categories) {
      paths.push({
        params: { lang, category },
      });
    }
  }
  
  return paths;
}

const { lang, category } = Astro.params as { lang: Language; category: string };
const t = useTranslations(lang);

const allPosts = await getCollection('blog', ({ data }) => 
  data.language === lang && data.categories?.includes(category)
);
const sortedPosts = allPosts.sort((a, b) => 
  b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<MainLayout 
  title={`${t('blog.title')} - ${t(`blog.category.${category}`)}`}
  description={t('site.tagline')}
  lang={lang}
>
  <div class="py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <a 
        href={`/${lang}/blog`}
        class="inline-flex items-center text-primary-700 hover:text-primary-900 mb-8 font-medium"
      >
        ‚Üê {t('blog.backToBlog')}
      </a>
      
      <h1 class="text-4xl font-bold text-gray-900 mb-4">
        {t('blog.postsInCategory')}: {t(`blog.category.${category}`)}
      </h1>
      
      <p class="text-xl text-gray-600 mb-12">
        {sortedPosts.length} {sortedPosts.length === 1 ? 'post' : 'posts'}
      </p>
      
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        {sortedPosts.map(post => (
          <PostCard
            title={post.data.title}
            description={post.data.description}
            pubDate={post.data.pubDate}
            slug={post.id}
            lang={lang}
            categories={post.data.categories}
            heroImage={post.data.heroImage}
          />
        ))}
      </div>
    </div>
  </div>
</MainLayout>

