---
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import MainLayout from '../../../layouts/MainLayout.astro';
import BookCard from '../../../components/BookCard.astro';
import { type Language, useTranslations, languages } from '../../../i18n/utils';

export async function getStaticPaths() {
  return Object.keys(languages).map(lang => ({ params: { lang } }));
}

const { lang } = Astro.params as { lang: Language };
const t = useTranslations(lang);

const allBooksCollection = (await getCollection('books' as any)) as any[];
const allBooks = allBooksCollection.filter(book => book.data.language === lang);

const booksByCategory = {
  radio: allBooks.filter(book => book.data.category === 'radio'),
  tobacco: allBooks.filter(book => book.data.category === 'tobacco'),
  other: allBooks.filter(book => book.data.category === 'other'),
};
---

<MainLayout 
  title={t('books.title')}
  description={t('site.tagline')}
  lang={lang}
>
  <div class="py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <h1 class="text-4xl font-bold text-gray-900 mb-12 text-center">
        {t('books.title')}
      </h1>

      {booksByCategory.radio.length > 0 && (
        <section class="mb-16">
          <h2 class="text-3xl font-bold text-gray-900 mb-8">
            {t('books.category.radio')}
          </h2>
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
            {booksByCategory.radio.map(book => (
              <BookCard
                title={book.data.title}
                category={book.data.category}
                coverImage={book.data.coverImage}
                summary={book.data.summary}
                slug={book.id}
                lang={lang}
                publicationDate={book.data.publicationDate}
              />
            ))}
          </div>
        </section>
      )}

      {booksByCategory.tobacco.length > 0 && (
        <section class="mb-16">
          <h2 class="text-3xl font-bold text-gray-900 mb-8">
            {t('books.category.tobacco')}
          </h2>
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
            {booksByCategory.tobacco.map(book => (
              <BookCard
                title={book.data.title}
                category={book.data.category}
                coverImage={book.data.coverImage}
                summary={book.data.summary}
                slug={book.id}
                lang={lang}
                publicationDate={book.data.publicationDate}
              />
            ))}
          </div>
        </section>
      )}

      {booksByCategory.other.length > 0 && (
        <section>
          <h2 class="text-3xl font-bold text-gray-900 mb-8">
            {t('books.category.other')}
          </h2>
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
            {booksByCategory.other.map(book => (
              <BookCard
                title={book.data.title}
                category={book.data.category}
                coverImage={book.data.coverImage}
                summary={book.data.summary}
                slug={book.id}
                lang={lang}
                publicationDate={book.data.publicationDate}
              />
            ))}
          </div>
        </section>
      )}
    </div>
  </div>
</MainLayout>

